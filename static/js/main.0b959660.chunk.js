(this["webpackJsonpapollo-music-share"]=this["webpackJsonpapollo-music-share"]||[]).push([[0],{177:function(e,t,n){"use strict";n.r(t);var a,i,r=n(241),c=n(242),o=n(0),s=n.n(o),l=n(19),u=n.n(l),d=n(15),j=n(234),b=n(237),p=n(247),h=n(71),O=n.n(h),g=n(93),m=n(21),x=n(27),f=n(243),v=n(212),y=n(249),S=n(215),w=n(216),N=n(244),C=n(217),I=n(218),k=n(219),_=n(220),q=n(221),P=n(75),E=n.n(P),T=n(114),A=n.n(T),F=n(115),G=n.n(F),Q=n(41),D=n(245),$=Object(D.a)(a||(a=Object(Q.a)(["\n  mutation addOrRemoveFromQueue($input: SongInput!) {\n    addOrRemoveFromQueue(input: $input) @client\n  }\n"]))),R=Object(D.a)(i||(i=Object(Q.a)(["\n  mutation addSong(\n    $title: String!\n    $artist: String!\n    $thumbnail: String!\n    $duration: Float!\n    $url: String!\n  ) {\n    insert_songs(\n      objects: {\n        title: $title\n        artist: $artist\n        thumbnail: $thumbnail\n        duration: $duration\n        url: $url\n      }\n    ) {\n      affected_rows\n    }\n  }\n"]))),L=n(5),J=Object(v.a)((function(e){return{container:{display:"flex",alignItems:"center"},urlInput:{margin:e.spacing(1)},addSongButton:{margin:e.spacing(1)},dialog:{textAlign:"center"},thumbnail:{width:"90%"}}})),M={duration:0,title:"",artist:"",thumbnail:""};var U=function(){var e=J(),t=Object(f.a)(R),n=Object(d.a)(t,2),a=n[0],i=n[1].error,r=s.a.useState(""),c=Object(d.a)(r,2),o=c[0],l=c[1],u=s.a.useState(!1),j=Object(d.a)(u,2),b=j[0],p=j[1],h=s.a.useState(!1),v=Object(d.a)(h,2),P=v[0],T=v[1],F=s.a.useState(M),Q=Object(d.a)(F,2),D=Q[0],$=Q[1];function U(e){var t=e.target,n=t.name,a=t.value;$((function(e){return Object(x.a)(Object(x.a)({},e),{},Object(m.a)({},n,a))}))}function Y(){T(!1)}function z(){return(z=Object(g.a)(O.a.mark((function e(t){var n,a,i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.player,!(a=n.player.player).getVideoData){e.next=6;break}i=B(a),e.next=10;break;case 6:if(!a.getCurrentSound){e.next=10;break}return e.next=9,W(a);case 9:i=e.sent;case 10:$(Object(x.a)(Object(x.a)({},i),{},{url:o}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e){var t=e.getDuration(),n=e.getVideoData(),a=n.title,i=n.video_id;return{duration:t,title:a,artist:n.author,thumbnail:"https://img.youtube.com/vi/".concat(i,"/0.jpg")}}function W(e){return new Promise((function(t){e.getCurrentSound((function(e){e&&t({duration:Number(e.duration/1e3),title:e.title,artist:e.user.username,thumbnail:e.artwork_url.replace("-large","-t500x500")})}))}))}function V(){return(V=Object(g.a)(O.a.mark((function e(){var t,n,i,r,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=D.url,n=D.duration,i=D.title,r=D.artist,c=D.thumbnail,e.next=4,a({variables:{url:t.length>0?t:null,duration:n>0?n:null,title:i.length>0?i:null,artist:r.length>0?r:null,thumbnail:c.length>0?c:null}});case 4:Y(),$(M),l(""),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error adding song",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function Z(e){return null===i||void 0===i?void 0:i.graphQLErrors[0].extensions.path.includes(e)}s.a.useEffect((function(){var e=A.a.canPlay(o)||G.a.canPlay(o);p(e)}),[o]);var H=D.thumbnail,K=D.title,X=D.artist;return Object(L.jsxs)("div",{className:e.container,children:[Object(L.jsxs)(y.a,{className:e.dialog,open:P,onClose:Y,children:[Object(L.jsx)(S.a,{children:"Edit Song"}),Object(L.jsxs)(w.a,{children:[Object(L.jsx)("img",{className:e.thumbnail,src:H,alt:"Song Thumbnail"}),Object(L.jsx)(N.a,{value:K,onChange:U,margin:"dense",name:"title",label:"Title",fullWidth:!0,error:Z("title"),helperText:Z("title")&&"Fill out field"}),Object(L.jsx)(N.a,{value:X,onChange:U,margin:"dense",name:"artist",label:"Artist",fullWidth:!0,error:Z("artist"),helperText:Z("artist")&&"Fill out field"}),Object(L.jsx)(N.a,{value:H,onChange:U,margin:"dense",name:"thumbnail",label:"Thumbnail",fullWidth:!0,error:Z("thumbnail"),helperText:Z("thumbnail")&&"Fill out field"})]}),Object(L.jsxs)(C.a,{children:[Object(L.jsx)(I.a,{onClick:Y,color:"secondary",children:"Cancel"}),Object(L.jsx)(I.a,{color:"primary",variant:"outlined",onClick:function(){return V.apply(this,arguments)},children:"Add Song"})]})]}),Object(L.jsx)(N.a,{className:e.urlInput,onChange:function(e){return l(e.target.value)},value:o,placeholder:"Add YouTube or SoundCloud URL",fullWidth:!0,margin:"normal",variant:"outlined",type:"url",InputProps:{startAdornment:Object(L.jsx)(k.a,{position:"start",children:Object(L.jsx)(_.a,{})})}}),Object(L.jsx)(I.a,{disabled:!b,className:e.addSongButton,onClick:function(){return T(!0)},variant:"contained",color:"primary",endIcon:Object(L.jsx)(q.a,{}),children:"Add"}),Object(L.jsx)(E.a,{url:o,hidden:!0,onReady:function(e){return z.apply(this,arguments)}})]})},Y=n(222),z=n(223),B=n(127),W=n(119),V=n.n(W),Z=Object(v.a)((function(e){return{title:{marginLeft:e.spacing(1)}}}));var H,K=function(){var e=Z();return Object(L.jsx)(Y.a,{color:"primary",position:"fixed",children:Object(L.jsxs)(z.a,{children:[Object(L.jsx)(V.a,{}),Object(L.jsx)(B.a,{className:e.title,variant:"h6",component:"h1",children:"Apollo Music Share"})]})})},X=n(252),ee=n(224),te=n(225),ne=n(226),ae=n(227),ie=n(228),re=n(229),ce=n(230),oe=n(231),se=n(232),le=Object(D.a)(H||(H=Object(Q.a)(["\n  subscription getSongs {\n    songs(order_by: { created_at: desc }) {\n      url\n      title\n      thumbnail\n      id\n      duration\n      artist\n    }\n  }\n"])));var ue=Object(v.a)((function(e){return{container:{margin:e.spacing(3)},songInfoContainer:{display:"flex",alignItmes:"center"},songInfo:{width:"100%",display:"flex",justifyContent:"space-between"},thumbnail:{objectFit:"cover",width:140,height:140}}}));function de(e){var t=e.song,n=t.id,a=ue(),i=Object(f.a)($,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),r=Object(d.a)(i,1)[0],c=s.a.useContext(Ie),o=c.state,l=c.dispatch,u=s.a.useState(!1),j=Object(d.a)(u,2),b=j[0],p=j[1],h=t.title,O=t.artist,g=t.thumbnail;return s.a.useEffect((function(){var e=o.isPlaying&&n===o.song.id;p(e)}),[n,o.song.id,o.isPlaying]),Object(L.jsx)(te.a,{className:a.container,children:Object(L.jsxs)("div",{className:a.songInfoContainer,children:[Object(L.jsx)(ne.a,{className:a.thumbnail,image:g}),Object(L.jsxs)("div",{className:a.songInfo,children:[Object(L.jsxs)(ae.a,{children:[Object(L.jsx)(B.a,{gutterbottom:"true",variant:"h5",component:"h2",children:h}),Object(L.jsx)(B.a,{variant:"body1",component:"p",color:"textSecondary",children:O})]}),Object(L.jsxs)(ie.a,{children:[Object(L.jsx)(re.a,{size:"small",color:"primary",onClick:function(){l({type:"SET_SONG",payload:{song:t}}),l(o.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},children:b?Object(L.jsx)(ce.a,{}):Object(L.jsx)(oe.a,{})}),Object(L.jsx)(re.a,{size:"small",color:"secondary",onClick:function(){r({variables:{input:Object(x.a)(Object(x.a)({},t),{},{__typename:"Song"})}})},children:Object(L.jsx)(se.a,{})})]})]})]})})}var je=function(){var e=Object(X.a)(le),t=e.data,n=e.loading,a=e.error;return n?Object(L.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:50},children:Object(L.jsx)(ee.a,{})}):a?(console.dir(a),Object(L.jsx)("div",{children:"Error fetching songs"})):Object(L.jsx)("div",{children:Object(L.jsx)("h2",{children:t.songs.map((function(e){return Object(L.jsx)(de,{song:e},e.id)}))})})},be=n(251),pe=n(235),he=n(236),Oe=n(250),ge=n(233),me=Object(v.a)({container:{display:"grid",gridAutoFlow:"column",gridTemplateColumns:"50px auto 50px",gridGap:12,alignItems:"center",marginTop:10},avatar:{width:44,height:44},songInfoContainer:{overflow:"hidden",whiteSpace:"nowrap"},text:{textOverflow:"ellipsis",overflow:"hidden"}});function xe(e){var t=e.song,n=me(),a=Object(f.a)($,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),i=Object(d.a)(a,1)[0],r=t.thumbnail,c=t.artist,o=t.title;return Object(L.jsxs)("div",{className:n.container,children:[Object(L.jsx)(Oe.a,{className:n.avatar,src:r,alt:"Song Thumbnail"}),Object(L.jsxs)("div",{className:n.songInfoContainer,children:[Object(L.jsx)(B.a,{className:n.text,variant:"subtitle2",children:o}),Object(L.jsx)(B.a,{className:n.text,variant:"body2",color:"textSecondary",children:c})]}),Object(L.jsx)(re.a,{onClick:function(){i({variables:{input:Object(x.a)(Object(x.a)({},t),{},{__typename:"Song"})}})},children:Object(L.jsx)(ge.a,{color:"error"})})]})}var fe,ve=function(e){var t=e.queue;return Object(j.a)((function(e){return e.breakpoints.up("md")}))&&Object(L.jsxs)("div",{style:{margin:"10px 0"},children:[Object(L.jsxs)(B.a,{color:"textSecondary",variant:"button",children:["Queue (",t.length,")"]}),t.map((function(e,t){return Object(L.jsx)(xe,{song:e},t)}))]})},ye=Object(D.a)(fe||(fe=Object(Q.a)(["\n  query GET_QUEUED_SONGS {\n    queue @client {\n      id\n      duration\n      title\n      artist\n      thumbnail\n      url\n    }\n  }\n"]))),Se=n(248),we=Object(v.a)((function(e){return{container:{display:"flex",justifyContent:"space-between"},details:{display:"flex",flexDirection:"column",padding:"0px 15px"},content:{flex:"1 0 auto"},thumbnail:{width:150},controls:{display:"flex",alignItems:"center",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},playIcon:{height:38,width:38}}}));var Ne=function(){var e,t=Object(Se.a)(ye).data,n=s.a.useRef(),a=s.a.useContext(Ie),i=a.state,r=a.dispatch,c=s.a.useState(0),o=Object(d.a)(c,2),l=o[0],u=o[1],j=s.a.useState(0),b=Object(d.a)(j,2),p=b[0],h=b[1],O=s.a.useState(!1),g=Object(d.a)(O,2),m=g[0],x=g[1],f=s.a.useState(0),v=Object(d.a)(f,2),y=v[0],S=v[1],w=we();return s.a.useEffect((function(){var e=t.queue.findIndex((function(e){return e.id===i.song.id}));S(e)}),[t.queue,i.song.id]),s.a.useEffect((function(){var e=t.queue[y+1];l>=.99&&e&&(u(0),r({type:"SET_SONG",payload:{song:e}}))}),[t.queue,y,l,r]),Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)(te.a,{variant:"outlined",className:w.container,children:[Object(L.jsxs)("div",{className:w.details,children:[Object(L.jsxs)(ae.a,{className:w.content,children:[Object(L.jsx)(B.a,{variant:"h5",component:"h3",children:i.song.title}),Object(L.jsx)(B.a,{variant:"subtitle1",component:"p",color:"textSecondary",children:i.song.artist})]}),Object(L.jsxs)("div",{className:w.controls,children:[Object(L.jsx)(re.a,{onClick:function(){var e=t.queue[y-1];e&&r({type:"SET_SONG",payload:{song:e}})},children:Object(L.jsx)(pe.a,{})}),Object(L.jsx)(re.a,{onClick:function(){r(i.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},children:i.isPlaying?Object(L.jsx)(ce.a,{className:w.playIcon}):Object(L.jsx)(oe.a,{className:w.playIcon})}),Object(L.jsx)(re.a,{onClick:function(){var e=t.queue[y+1];e&&r({type:"SET_SONG",payload:{song:e}})},children:Object(L.jsx)(he.a,{})}),Object(L.jsx)(B.a,{variant:"subtitle1",component:"p",color:"textSecondary",children:(e=p,new Date(1e3*e).toISOString().substr(11,8))})]}),Object(L.jsx)(be.a,{onMouseDown:function(){x(!0)},onMouseUp:function(){x(!1),n.current.seekTo(l)},onChange:function(e,t){u(t)},value:l,type:"range",min:0,max:1,step:.01})]}),Object(L.jsx)(E.a,{ref:n,onProgress:function(e){var t=e.played,n=e.playedSeconds;m||(u(t),h(n))},url:i.song.url,playing:i.isPlaying,hidden:!0}),Object(L.jsx)(ne.a,{className:w.thumbnail,image:i.song.thumbnail})]}),Object(L.jsx)(ve,{queue:t.queue})]})};var Ce=function(e,t){switch(t.type){case"SET_SONG":return Object(x.a)(Object(x.a)({},e),{},{song:t.payload.song});case"PLAY_SONG":return Object(x.a)(Object(x.a)({},e),{},{isPlaying:!0});case"PAUSE_SONG":return Object(x.a)(Object(x.a)({},e),{},{isPlaying:!1});default:return e}},Ie=s.a.createContext({song:{id:"a49b4840-59e6-45c4-98b7-671873988b80",title:"Superposition",artist:"Young the Giant",thumbnail:"https://img.youtube.com/vi/QxJhrwyn0M4/0.jpg",url:"https://www.youtube.com/watch?v=QxJhrwyn0M4",duration:232},isPlaying:!1});var ke,_e=function(){var e=s.a.useContext(Ie),t=s.a.useReducer(Ce,e),n=Object(d.a)(t,2),a=n[0],i=n[1],r=Object(j.a)((function(e){return e.breakpoints.up("sm")})),c=Object(j.a)((function(e){return e.breakpoints.up("md")}));return Object(L.jsx)(Ie.Provider,{value:{state:a,dispatch:i},children:Object(L.jsxs)(b.a,{container:!0,spacing:3,children:[Object(L.jsxs)(b.a,{style:{paddingTop:r?"80px":"10px"},item:!0,xs:12,md:7,children:[Object(L.jsx)(p.a,{only:"xs",children:Object(L.jsx)(K,{})}),Object(L.jsx)(U,{}),Object(L.jsx)(je,{})]}),Object(L.jsx)(b.a,{style:c?{position:"fixed",width:"100%",right:0,top:"65px"}:{position:"fixed",width:"100%",bottom:0},item:!0,xs:12,md:5,children:Object(L.jsx)(Ne,{})})]})})},qe=n(240),Pe=n(122),Ee=n(238),Te=n(239),Ae=Object(Pe.a)({palette:{type:"dark",primary:Ee.a,secondary:Te.a}}),Fe=n(34),Ge=n(124),Qe=n(121),De=n(123),$e=new Ge.a({link:new Qe.a({uri:"wss://apollo-tunes-share.hasura.app/v1/graphql",options:{reconnect:!0,connectionParams:{headers:{"x-hasura-admin-secret":"6Aaz3fUJMDTtHZZe0LzSZLlhN1MJ5e2UVXh4bed12mbuKvD966325mv9kLihDumI"}}}}),cache:new De.a,typeDefs:Object(D.a)(ke||(ke=Object(Q.a)(["\n    type Song {\n      id: uuid!\n      title: String!\n      artist: String!\n      thumbnail: String!\n      duration: Float!\n      url: String!\n    }\n    input SongInput {\n      id: uuid!\n      title: String!\n      artist: String!\n      thumbnail: String!\n      duration: Float!\n      url: String!\n    }\n    type Query {\n      queue: [Song]!\n    }\n    type Mutation {\n      addOrRemoveFromQueue(input: SongInput!): [Song]!\n    }\n  "]))),resolvers:{Mutation:{addOrRemoveFromQueue:function(e,t,n){var a=t.input,i=n.cache,r=i.readQuery({query:ye});if(r){var c=r.queue,o=c.some((function(e){return e.id===a.id}))?c.filter((function(e){return e.id!==a.id})):[].concat(Object(Fe.a)(c),[a]);return i.writeQuery({query:ye,data:{queue:o}}),o}return[]}}}}),Re={queue:Boolean(localStorage.getItem("queue"))?JSON.parse(localStorage.getItem("queue")):[]};$e.writeData({data:Re});var Le=$e;u.a.render(Object(L.jsx)(qe.a,{client:Le,children:Object(L.jsxs)(r.a,{theme:Ae,children:[Object(L.jsx)(c.a,{}),Object(L.jsx)(_e,{})]})}),document.getElementById("root"))}},[[177,1,2]]]);
//# sourceMappingURL=main.0b959660.chunk.js.map